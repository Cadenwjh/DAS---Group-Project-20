Combine with the the Explanatory Data Analysis File, this section is the next one.

---
title: "Group 20"
format: 
  html:
    embed-resources: true
    code-tools: true
  pdf: default
editor_options: 
  chunk_output_type: console
execute:
  echo: false
  eval: true
  warning: false
  message: false
---

```{r}
library(dplyr)
library(ggplot2)
library(faraway)
library(gridExtra)
library(MASS)
library(plyr)
library(dplyr)
library(sjPlot)
library(AER)
```

# Inferential Statistical Analysis

In this section, several formal statistical models will be conducted using a Generalized Model Analysis to infer the relationships between variables.

## Model Fitting

###This should be conducted on the EDA section, so after combined it, this should be removed.

```{r}
data <- read.csv('dataset20.csv', stringsAsFactors = FALSE)
str(data)

data$animal_type <- as.factor(data$animal_type)
data$intake_type <- as.factor(data$intake_type)
data$chip_status <- as.factor(data$chip_status)
levels(data$year)
```

### Poisson model

Since the response variable represents the count data, the Poisson regression model is a starting point because it's the simplest model for the type of the data.

```{r}
glm_poisson <- glm(time_at_shelter ~ animal_type + month + year + intake_type + chip_status, family = "poisson", data = data)
summary(glm_poisson)
```

Before presenting and interpreting the derived equation from our GLM analysis, it's important to note that validating the model's underlying assumptions is a critical step. Ensuring the assumptions hold true bolsters the reliability of our findings. Here's the equation based on the initial analysis, subject to further validation:

$$
\log(\text{Expected Count of Time at Shelter}) = 578.124443 + 2.765699 \times \text{AnimalTypeCat} + 2.875463 \times \text{AnimalTypeDog} + 2.609189 \times \text{AnimalTypeWildlife} - 0.030088 \times \text{Month} - 0.286813 \times \text{Year} - 0.735566 \times \text{IntakeTypeOwnerSurrender} - 0.517652 \times \text{IntakeTypeStray} - 0.472796 \times \text{ChipStatusUnableToScan}
$$

where,  
(\text{AnimalTypeCat}\), \(\text{AnimalTypeDog}\),(\text{AnimalTypeWildlife}\) are indicator variables for the animal types, taking the value 1 if the condition is true and 0 otherwise.
- \(\text{Month}\) and \(\text{Year}\) are numerical variables representing the month and year of intake.
- \(\text{IntakeTypeOwnerSurrender}\) and \(\text{IntakeTypeStray}\) are indicator variables for the intake types, taking the value 1 if the condition is true and 0 otherwise.

#### Model Diagnostics and Assumptions Checking

Our analysis employed a Poisson regression model to explore how various factors, including **`animal_type`**, **`month`**, **`year`**, **`intake_type`**, and **`chip_status`**, affect the length of stay in a shelter. We assessed the model's goodness-of-fit through deviance and Pearson's chi-squared statistics, which compare observed data to model predictions. Values close to the degrees of freedom for these statistics suggest an adequate fit. Additionally, we evaluated the dispersion parameter to identify potential overdispersion, a condition where observed variance surpasses the mean, contrary to the Poisson assumption of equidispersion. Residual analysis was also conducted to ensure no systematic patterns were present, which could indicate model specification issues.

**Deviance:**

Deviance is used to quantify the difference between a fitted model and a perfect model (a saturated model that fits the data exactly).

-   Null Deviance: this represents the goodness of fit of a model that includes only the intercept (no predictors). It is 10754 on 1464 degrees of freedom.

-   Residual Deviance: This is the goodness of fit of the model that includes predictors (**`animal_type`**, **`month`**, **`year`**, **`intake_type`**, **`chip_status`**). It is 10266 on 1455 degrees of freedom.

The residual deviance is used to assess the fit of the model to the data. For a well-fitting model, the residual deviance should be close to the degrees of freedom (relatively low). Here, the residual deviance (10266) is quite high compared to the degrees of freedom (1455), which might indicate that the model does not fit the data perfectly. This could be a sign of overdispersion or that the model is missing some key explanatory variables.

**Dispersion**

```{r}
dispersiontest(glm_poisson)
par(mfrow=c(2,2))
plot(glm_poisson)
```

The hypothesis being tested relates to the dispersion of the data with a significance level 5% is stated below:

**Null Hypothesis (H0):**

The null hypothesis posits that the true dispersion parameter equals 1. This means the data follow a Poisson distribution accurately, where the mean and variance of the count data are equal (equidispersion). The model is adequately specified, and there's no extra variability in the data beyond what the Poisson model accounts for.

**Alternative Hypothesis (Ha):**

The alternative hypothesis suggests that the true dispersion parameter is greater than 1, indicating overdispersion in the data. Overdispersion occurs when the observed variance in the count data is greater than what the Poisson model would predict based on the mean.

**Interpretation:**

-   p-value is extremely small, below the significance level, which indicates that the result is highly statistically significant. Hence, this supports the alternative hypothesis that the true dispersion is greater than 1.

-   The sample estimated - dispersion is 8.52551 which is substantially greater than 1, indicating a significant level of overdispersion in the data.

-   Given this evidence of overdispersion, it would be prudent to consider alternative models that can accommodate the extra variability, such as a Negative Binomial regression model which will be conducted later.

### Negative Binomial Model

```{r}
# dispersion
glm_model_all_nb <- glm.nb(time_at_shelter ~ animal_type + intake_type + chip_status, data = data)
summary(glm_model_all_nb)
```

```{r}
plot_model(glm_model_all_nb,show.values = TRUE)
CI <- exp(confint.default(glm_model_all_nb))
# animal_type contains 1
# chip_status contains 1
```

```{r}
par(mfrow=c(2,2))
plot(glm_model_all_nb)
# QQ plot is not good
```

```{r}
aic_poisson <- AIC(glm_model_all)
aic_nb <- AIC(glm_model_all_nb)
aic_poisson
aic_nb
```

```{r}
drop1(glm_model_all_nb, test = "F")
```

## Model Selection

## Model Interpretation and Conclusion
